var e=require("path"),r=require("fs"),t=require("babel-plugin-macros");function a(t,i,n,o){void 0===o&&(o="");var l=i.map(function(i){if(Array.isArray(i))return t.objectProperty(t.stringLiteral(i[0]),a(t,i[1],e.join(n,i[0]),o));try{var l=o.startsWith(".")&&i.endsWith(o)?i:i+o,s=require.resolve("./"+l,{paths:[n]});return t.objectProperty(t.stringLiteral(i.replace(o,"")),t.stringLiteral(r.readFileSync(s,"utf-8")))}catch(e){return null}}).filter(Boolean);if(0===l.length)throw new Error("Cannot resolve file "+o+" in these directories: "+i.join(", "));return t.objectExpression(l)}module.exports=(0,t.createMacro)(function(t){var i=t.state,n=t.babel,o={value:0};t.references.default.forEach(function(t){if("CallExpression"!==t.parentPath.type)throw new Error("This is not supported: `"+t.findParent(n.types.isExpression).getSource()+"`. Please see the raw.macro documentation");!function(t){var i,n=t.referencePath,o=t.usageCounter,l=t.babel.types,s=n.parentPath,u=e.dirname(t.state.file.opts.filename),c=s.get("arguments")[0];switch(c.node.type){case"TemplateLiteral":var f=c.node,v=f.expressions,h=f.quasis;if(0===v.length){i=h[0].value.raw;break}try{if(void 0!==(i=s.get("arguments")[0].evaluate().value))break}catch(e){}if(""===h[0].value.raw)throw new Error("Invalid value, variable interpolation can't be at the start of template literal");if(v.length>2)throw new Error("Invalid value. You can only have 2 dynamic values max. 1 for directory name, 1 for file name.");var d="__raw_dynamic__"+o.value;o.value++;var p=v.map(function(e,r){var t=r!==h.length-1&&c.node.quasis[r+1].value.raw.startsWith("/");return{name:e.name,isDirectory:t}}),m=e.join(u,h[0].value.raw),y=r.readdirSync(m).filter(function(t){try{return r.lstatSync(e.join(m,t)).isDirectory()===p[0].isDirectory}catch(e){return!1}}).flatMap(function(e){return p[0].isDirectory?e:e.endsWith(h[1].value.raw)?e.replace(h[1].value.raw,""):[]});return h.slice(1).forEach(function(t,a){p[a].isDirectory&&y.forEach(function(i,n){if(!t.tail){var o=e.join(m,i),l=r.readdirSync(o).filter(function(e){return e.endsWith(h[a+2].value.raw)});y[n]=[i,l]}})}),function e(r){return r.parentPath?e(r.parentPath):r}(n).unshiftContainer("body",l.variableDeclaration("var",[l.variableDeclarator(l.identifier(d),a(l,y,m,h[h.length-1].value.raw))])),void s.replaceWith(l.expressionStatement(p.reduce(function(e,r){return l.memberExpression(e,l.identifier(r.name),!0)},l.identifier(d))));case"StringLiteral":i=c.node.value}if(void 0===i)throw new Error("There was a problem evaluating the value of the argument for the code: "+s.getSource()+". If the value is dynamic, please make sure that its value is statically deterministic.");var g=require.resolve(i,{paths:[u]}),w=r.readFileSync(g,{encoding:"utf-8"});s.replaceWith(l.expressionStatement(l.stringLiteral(w)))}({referencePath:t,state:i,babel:n,usageCounter:o})})});
//# sourceMappingURL=raw.macro.js.map
